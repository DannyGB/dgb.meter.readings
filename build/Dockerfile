FROM golang:1.19.1

RUN mkdir /app

COPY . /app

WORKDIR /app/cmd/meter.readings

ARG ENVIRONMENT=dev
ENV METER_READINGS_ENVIRONMENT $ENVIRONMENT

ARG HTTP_PORT=80
ENV METER_READINGS_HTTP_PORT $HTTP_PORT

ARG MONGO_COLLECTION=readings
ENV METER_READINGS_MONGO_COLLECTION $MONGO_COLLECTION

ARG MONGO_DB=meter
ENV METER_READINGS_MONGO_DB $MONGO_DB

ARG MONGO_CONNECTION
ENV METER_READINGS_MONGO_CONNECTION $MONGO_CONNECTION

ARG CORS_CLIENTS="*"
ENV METER_READINGS_CORS_CLIENTS $CORS_CLIENTS

RUN go build -o meter.readings .

CMD [ "/app/cmd/meter.readings/meter.readings" ]
